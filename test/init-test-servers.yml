---
- name: Prepare servers for ansible
  hosts: postgres
  gather_facts: false
  become: True
  pre_tasks:
    - name: Install missing python 2 in xenial
      raw: test -e /usr/bin/python || (apt -y update && apt install -y python-minimal)
      register: output
      changed_when: output.stdout != ""


- name: Test env postgres software setup
  hosts: postgres
  remote_user: vagrant
  become: True
  vars:
    postgres_version: "9.6.4-1"
  pre_tasks:
    - name: copy hosts file for cross-VM communication
      copy: src=hosts dest=/etc/hosts
  roles:
    - {role: private-postgres-rds, tags: 'postgresql'} # to register handlers etc.
  tasks:
    - name: Install postgres software
      include_role:
        name: private-postgres-rds
        tasks_from: install_binary

